---
title: CTF é¢˜ç›®å­˜å‚¨ç»“æž„ä¸Žç±»åž‹æ’ä»¶åŒ–
date: 2024-01-20T02:34:01+08:00
tags: [CTF, Linux, Development]
categories: [Development]
---

## èµ·å› 

> ~~ðŸ‘´ï¼šå“Žè¿™ä¸ª CTF è®¾è®¡æ€Žä¹ˆè¿™ä¹ˆæŠ½è±¡å•Šï¼Œåˆè¦æœ‰é™æ€ flag åˆè¦æœ‰åŠ¨æ€ flag è¿˜***è¦ä¸Š OJ æžç¨‹åºè¯„æµ‹~~

## çŽ°æœ‰æ–¹æ¡ˆï¼ˆï¼Ÿï¼‰

è¿™ä¸ªæ•…äº‹åº”è¯¥è¦ä»Ž CTFd å¼€å§‹è®²ã€‚ CTFd æœ¬èº«è®¾è®¡ä¸ºä¸€ä¸ªå¯ä»¥å…¨æ–¹ä½æ‰©å±•çš„è§£é¢˜å¹³å°ï¼Œå…¶ Flag éªŒè¯ã€å¹³å°åŠŸèƒ½éƒ½æ˜¯é‡‡ç”¨æ’ä»¶åŒ–çš„ç»“æž„æ¥å®žçŽ°çš„ã€‚ä½†æ˜¯å¾ˆä¸å·§çš„æ˜¯ï¼Œè¿™ä¸ªæ’ä»¶åŒ–åšçš„æœ‰ä¸€äº›é—®é¢˜ï¼Œå¤ªè¿‡è‡ªç”±çš„ç»“æž„å¯¼è‡´ç»™æ’ä»¶å¼€å‘è€…å¸¦æ¥äº†å¾ˆå¤§çš„å¿ƒç†è´Ÿæ‹…å’Œç»´æŠ¤åŽ‹åŠ›ï¼Œä»…ä»…å®žçŽ°åŠŸèƒ½è¿˜ä¸å¤Ÿï¼Œè¿˜è¦é™„å¸¦å®žçŽ°å‰ç«¯ï¼Œè€Œä¸€äº›é€»è¾‘è¿˜è€¦åˆåœ¨ Controller ä¸­ï¼Œå¯¼è‡´é‡åˆ°æŸäº›ç‰¹æ®Šçš„éœ€æ±‚è¿˜å¾—åŽ»æ”¹ CTFd çš„æºç ã€‚

åŽŸå› ä¹‹ä¸€æ˜¯ï¼ŒCTFd çš„æ–‡ä»¶ç®¡ç†åŠŸèƒ½æ˜¯è‡ªå¸¦çš„ï¼Œå‡ºé¢˜äººä¸Šä¼ ä¸€ä¸ªé¢˜ç›®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è®¡ç®—å®Œhashä¹‹åŽä¼šå­˜å…¥å“ˆå¸Œè·¯å¾„ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­ç•™ä¸‹ä¸€æ¡è®°å½•å…³è”åˆ°å¯¹åº”çš„é¢˜ç›®ï¼Œç„¶åŽæŒ‰ç…§åŽŸæ ·æä¾›ç»™é€‰æ‰‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ’ä»¶æ˜¯æ— æ³•è¿›è¡Œä¾µå…¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡ä»¶ç®¡ç†æœ¬èº«æ˜¯å®Œå…¨å—é™åˆ¶çš„ã€‚è€ŒåŠ¨æ€å®¹å™¨å°±ä¸åŒäº†ï¼ŒCTFd ä»Žè®¾è®¡ä¹‹åˆå°±æ²¡æœ‰è€ƒè™‘è¿‡å®¹å™¨çš„é—®é¢˜ï¼Œå°±å¯¼è‡´æ•´ä¸ªå®¹å™¨ç®¡ç†éƒ½éœ€è¦æ’ä»¶è¿›è¡Œå®žçŽ°ã€‚äºŽæ˜¯ï¼Œæ–‡ä»¶ç®¡ç†è¿™ä¸ªåŠŸèƒ½ä¸Žå®¹å™¨ç®¡ç†æ˜¯å®Œå…¨å‰²è£‚å¼€çš„ã€‚

å†åŽæ¥ï¼ŒGZ::CTF é€æ¸å é¢†äº†å›½å†… CTF èµ›äº‹çš„å¸‚åœºã€‚GZ::CTF å„æ–¹é¢ç”¨æˆ·ä½“éªŒåšçš„å¾ˆå¥½ï¼Œä¸è¿‡å¼€å‘è€…ä¸ºäº†æ•´ä½“ç”¨æˆ·ä½“éªŒèˆå¼ƒäº†å¾ˆå¤šæž¶æž„ä¸Šçš„è®¾è®¡ï¼Œå…¶ä¸­åŒ…æ‹¬è‡ªå®šä¹‰é¢˜ç›®åˆ†ç±»ã€é¢˜ç›®æ’ä»¶åŒ–ç­‰ç­‰ç­‰ã€‚åœ¨é¢˜ç›®æ–‡ä»¶çš„å­˜å‚¨ä¸Š GZ::CTF å¹¶æ²¡æœ‰åšå’Œ CTFd åŒºåˆ«å¾ˆå¤§çš„è®¾è®¡ï¼ŒåŠ å…¥äº†å¤–é“¾æ–‡ä»¶ã€æ ¹æ®é˜Ÿä¼idåŠ¨æ€åˆ†å‘é¢˜ç›®æ–‡ä»¶ç­‰æ”¯æŒï¼Œä½†æœ¬åœ°æ–‡ä»¶ä¾æ—§æ˜¯æŒ‰ç…§ç±»ä¼¼é€»è¾‘å­˜å‚¨å¹¶å…³è”åˆ°é¢˜ç›®çš„ã€‚

è¿™å°±å¯¼è‡´ä¸€äº›éœ€æ±‚åœ¨è¿™ç§æ–‡ä»¶å­˜å‚¨è®¾è®¡ä¸­å®žçŽ°èµ·æ¥å¾ˆæŠ½è±¡ï¼Œé€»è¾‘åŸºæœ¬æ˜¯è€¦åˆçš„ï¼š

1. **åŠ¨æ€é¢˜ç›®æ–‡ä»¶åˆ†å‘**ï¼šç»™æ¯ä¸ªé˜Ÿä¼åˆ†å‘ä¸åŒçš„é¢˜ç›®æ–‡ä»¶ï¼Œå¹¶æ˜ å°„åˆ°ä¸åŒçš„flagï¼Œä»¥æ­¤å®žçŽ°ä¸€äº›åä½œå¼ŠåŠŸèƒ½ï¼›
2. **åŠ¨æ€çŽ¯å¢ƒæŒ‚è½½**ï¼šæ— æ³•å°†é¢˜ç›®æ–‡ä»¶æŒ‚è½½è¿›é€‰æ‰‹ä½¿ç”¨çš„åŠ¨æ€å®¹å™¨ä¸­ã€‚è¿™ä¸ªéœ€æ±‚æœ‰ä¸€ä¸ªå›ºå®šçš„åœºæ™¯ï¼šOJè¯„æµ‹ï¼Œæˆ‘ä»¬æœ‰çŽ°æˆçš„è¯„æµ‹å®¹å™¨ï¼Œå®¹å™¨ä¸­ä¼šå¯¹é€‰æ‰‹çš„ç¨‹åºè¿›è¡Œç¼–è¯‘ï¼Œå¹¶é‡å®šå‘è¾“å…¥è¾“å‡ºæ–‡ä»¶ï¼Œæœ€ç»ˆè¿›è¡Œå¯¹æ¯”ã€‚å¦‚æžœä»…ä½¿ç”¨å®¹å™¨æœºåˆ¶è¿›è¡Œæµ‹è¯„çš„è¯ï¼Œæ„å‘³ç€æˆ‘ä»¬æ¯ä¸€é“è¯„æµ‹é¢˜ç›®éƒ½éœ€è¦å°†å®Œæ•´çš„è¾“å…¥è¾“å‡ºè¯„æµ‹æ–‡ä»¶æ‰“åŒ…è¿›å®¹å™¨é•œåƒä¹‹ä¸­ï¼›å¦‚æžœèƒ½å¤Ÿåœ¨å¯åŠ¨å®¹å™¨æ—¶å°†æ–‡ä»¶åŠ¨æ€æŒ‚è½½è¿›åŽ»ï¼Œé‚£ç»å¤§éƒ¨åˆ†è¯„æµ‹é¢˜ç›®åªéœ€è¦ä¸€ä¸ªå®¹å™¨é•œåƒå°±å¯ä»¥äº†ï¼›
3. **åŸºäºŽè‡ªå®šä¹‰è§„åˆ™çš„flagéªŒè¯æœºåˆ¶**ï¼šä¹‹å‰ @koito æå‡ºè¿‡ä¸€ä¸ªéœ€æ±‚ï¼Œå¸Œæœ›èƒ½å¤Ÿè‡ªå®šä¹‰flagéªŒè¯è„šæœ¬ï¼Œè¿™æ ·å°±å¯ä»¥æä¾›ä¸€äº›æ›´åŠ å¤æ‚çš„é¢˜ç›®ç±»åž‹å’ŒflagéªŒè¯æ–¹å¼äº†ã€‚emmmè™½ç„¶åœ¨Ruastä¸­å®žçŽ°ä¸€ä¸ªè‡ªå®šä¹‰éªŒè¯è„šæœ¬å¯èƒ½ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œä¸è¿‡ä¹Ÿä¸æ˜¯ä¸å½³äºã€‚é—®é¢˜åœ¨äºŽï¼Œåœ¨ä¼ ç»Ÿæ¨¡åž‹ä¸‹ï¼ŒflagéªŒè¯åªèƒ½æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ã€é¢˜ç›®ä¿¡æ¯ä»¥åŠç”¨æˆ·æäº¤çš„å†…å®¹ï¼Œè¿‡å°‘çš„ä¸Šä¸‹æ–‡å¯¼è‡´äº†è¿™ä¸ªâ€œè‡ªå®šä¹‰flagéªŒè¯è„šæœ¬â€æ˜¾å¾—å¾ˆé¸¡è‚‹ï¼Œä½ ç”¨å§ï¼Œå…¶å®žæ²¡æ¯”regexæä¾›å¤šå°‘çµæ´»æ€§ã€‚

ä»¥ä¸Šè¿™ä¸‰ä¸ªéœ€æ±‚åªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼Œä»–ä»¬éƒ½åæ˜ äº†ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼š

**é€‰æ‰‹ä¸‹è½½æ–‡ä»¶ã€åšé¢˜ã€æäº¤flagåˆ°å®Œæˆç­”æ¡ˆéªŒè¯è¿™ä¸ªæµç¨‹æ˜¯å¼ºè€¦åˆçš„**

ä¸€æ—¦æœ‰ä¸€äº›æ–°çš„éœ€æ±‚ï¼Œå°±éœ€è¦åœ¨è¿™ä¸ªæµç¨‹ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ’ä»¶ç³»ç»Ÿä¸€å®šæ˜¯æ— æ³•é¢é¢å…·åˆ°çš„ï¼Œå¼€å‘ä½“éªŒå’Œä½¿ç”¨ä½“éªŒæ€»è¦æ‰”ä¸€ä¸ªã€‚

é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆäºŒè€…å…¼é¡¾è€Œåˆä¸é‚£ä¹ˆæŠ½è±¡çš„æ–¹æ¡ˆå‘¢ï¼Ÿæ²¡å‡†æœ‰ï¼Œçœ‹ä¸‹é¢ã€‚

## åŸºäºŽXXXXï¼ˆç«žæ ‡ä¸€ä¸ªNBçš„æŠ€æœ¯è¯æ±‡ï¼‰çš„æŒ‘æˆ˜åº”ç­”é¢˜ç›®æœºåˆ¶

### é¢˜ç›®å­˜å‚¨ç»“æž„

åœ¨åˆ›å»ºé¢˜ç›®æ—¶ï¼Œå¹³å°ä¼šè‡ªåŠ¨ç»™é¢˜ç›®åˆ†é…ä¸€ä¸ªä¸“å±žå­˜å‚¨ç›®å½•ï¼Œè¿™é‡Œç§°ä¹‹ä¸º `Bucket`ã€‚åœ¨ `Bucket` ä¸­ï¼ŒæŒ‰ç…§ç”¨é€”åˆ†ä¸º4ä¸ªéƒ¨åˆ†ï¼š

- **`provided`**ï¼šå­˜æ”¾é™æ€é¢˜ç›®æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°è¿™é‡Œçš„æ–‡ä»¶ä¼šè¢«ç›´æŽ¥æä¾›ç»™é€‰æ‰‹ä¸‹è½½ï¼Œä¸ä¼šè¿›è¡Œä»»ä½•å¤„ç†ï¼›
- **`mapped`**ï¼šå­˜æ”¾åŠ¨æ€é¢˜ç›®æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°è¿™é‡Œçš„æ–‡ä»¶ä¼šè¢«åŠ¨æ€åˆ†å‘ç»™é€‰æ‰‹ï¼Œè¿™é‡Œçš„è®¾è®¡å…¶å®žæ˜¯ä¸€ä¸ªå¦¥åï¼ŒåŠ¨æ€åˆ†å‘çš„ç‰¹æ®Šæ€§å¯¼è‡´è¿™é‡Œçš„æ–‡ä»¶æ°¸è¿œåªèƒ½ç»™é€‰æ‰‹åˆ†å‘**1ä¸ª**å¯¹åº”æ–‡ä»¶ï¼Œå¦‚æžœéœ€è¦åŠ¨æ€åˆ†å‘å¤šä¸ªæ–‡ä»¶ï¼Œå°±åªèƒ½æå‰æ‰“åŒ…æˆtar/zipæ¥è§£å†³äº†ï¼›
- **`preserved`**ï¼šå­˜æ”¾é¢å¤–çš„è¯„æµ‹æ–‡ä»¶ï¼Œè¿™é‡Œçš„æ–‡ä»¶å¯¹é€‰æ‰‹æ˜¯ä¸å¯è§çš„ï¼Œä½†æ˜¯ä¼šåœ¨é€‰æ‰‹æäº¤flagæ—¶ä¼ é€’ç»™flagéªŒè¯å™¨ä½œä¸ºé¢å¤–çš„ä¸Šä¸‹æ–‡ã€‚åœ¨ç”¨é€”ä¸Šå…¶å®žå¯ä»¥å¾ˆå¤šæ ·ï¼Œä¾‹å¦‚æŠŠçœŸæ­£çš„flagéªŒè¯é€»è¾‘ä½œä¸ºè„šæœ¬æ”¾åœ¨è¿™ä¸ªåŒºåŸŸï¼Œç„¶åŽå®žçŽ°ä¸€ä¸ªflagéªŒè¯å™¨ï¼Œåœ¨éªŒè¯æ—¶å¯ç”¨æŸä¸ªè„šæœ¬å¼•æ“Žè¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œé…åˆç›¸å…³æ–‡ä»¶å’Œé¢˜ç›®ä¿¡æ¯ä¸Šä¸‹æ–‡è¿›è¡ŒéªŒè¯ï¼Œå¯ä»¥ç»™åˆ°å¾ˆé«˜çš„è‡ªç”±åº¦ï¼›
- **`mounted`**ï¼šå­˜æ”¾éœ€è¦è¢«æŒ‚è½½è¿›å®¹å™¨ä¸­çš„æ–‡ä»¶ï¼Œè¿™é‡Œçš„æ–‡ä»¶ä¼šæŒ‰ç…§æŒ‡å®šè·¯å¾„æŒ‚è½½è¿›é€‰æ‰‹åšé¢˜ç”¨çš„çŽ¯å¢ƒå®¹å™¨ä¸­ã€‚è¿™é‡Œåœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿè®¸å¯ä»¥å‡å°å‡ºé¢˜åŽ‹åŠ›ã€‚ä¾‹å¦‚åˆ¶ä½œå„ä¸ªç‰ˆæœ¬å¸¦æœ‰xinetdçš„ubuntué•œåƒï¼Œå‡ºé¢˜äººåªéœ€è¦è®¾ç½®å¥½æŒ‚è½½è·¯å¾„å¹¶ç»™å‡ºé¢˜ç›®äºŒè¿›åˆ¶æ–‡ä»¶æœ¬èº«å³å¯ä½œä¸ºä¸€é“å®Œæ•´çš„pwné¢˜ä½¿ç”¨ï¼Œä¸å†éœ€è¦è‡ªå·±å†™Dockerfileè¿›è¡Œæž„å»ºï¼Œå¯ä»¥å¾ˆæœ‰æ•ˆçš„å¤ç”¨çŽ°æœ‰çš„é•œåƒèµ„æºã€‚

### ç»„ä»¶åŒ–é¢˜ç›®éªŒè¯æœºåˆ¶

æœ‰äº†ä¸Šè¿°é¢˜ç›®å­˜å‚¨ç»“æž„ï¼ŒæŽ¥ä¸‹æ¥è¦å®žçŽ°ä¸€ä¸ªèƒ½å¤Ÿåˆ©ç”¨è¿™å¥—å­˜å‚¨ç»“æž„çš„é¢˜ç›®éªŒè¯æœºåˆ¶ï¼ŒåŒæ—¶ï¼Œè¿™å¥—æœºåˆ¶è¿˜åº”è¯¥èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„è¿›è¡Œæ‰©å±•ï¼Œä»¥æ»¡è¶³å„ç§å„æ ·çš„éœ€æ±‚ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ†æžä¸€ä¸‹é€‰æ‰‹åšé¢˜çš„æµç¨‹ï¼Œè¿™é‡Œé€‰äº†ä¸‰ç§å¸¸è§çš„é¢˜ç›®ç±»åž‹ï¼š

1. é€‰æ‰‹æ‰“å¼€é¢˜ç›®ï¼Œä¸‹è½½é¢˜ç›®é™„ä»¶ï¼Œè§£å‡ºflagï¼Œæäº¤flagå¹¶è¿›è¡Œé™æ€éªŒè¯ï¼›
2. é€‰æ‰‹æ‰“å¼€é¢˜ç›®ï¼Œä¸‹è½½åŠ¨æ€é™„ä»¶ï¼Œè§£å‡ºflagï¼Œæäº¤flagå¹¶è¿›è¡ŒåŠ¨æ€æ˜ å°„éªŒè¯ï¼›
3. é€‰æ‰‹æ‰“å¼€é¢˜ç›®ï¼Œå¯åŠ¨é¢˜ç›®çŽ¯å¢ƒï¼Œè§£å‡ºflagï¼Œæäº¤flagå¹¶ä¸ŽçŽ¯å¢ƒä¸­çš„flagå¯¹æ¯”éªŒè¯ï¼›

æŽ¥ä¸‹æ¥æ˜¯ç®¡ç†å‘˜çš„æ“ä½œæµç¨‹ï¼š

1. ä¸Šä¼ é™æ€é™„ä»¶ï¼Œè®¾ç½®flagï¼›
2. ä¸Šä¼ åŠ¨æ€é™„ä»¶ï¼Œè®¾ç½®flagï¼›
3. ä¸Šä¼ é™„ä»¶ï¼Œä¸è®¾ç½®flagï¼Œé…ç½®é¢˜ç›®é•œåƒï¼›

åœ¨è¿™å¥—æµç¨‹ä¸­ï¼Œé¢˜ç›®éªŒè¯æœºåˆ¶æ€»å…±æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¾µå…¥ç‚¹ï¼š

1. flagéªŒè¯ï¼šéªŒè¯é€‰æ‰‹æäº¤çš„flagæ˜¯å¦æ­£ç¡®ï¼›
2. åŠ¨æ€å®¹å™¨ï¼šåœ¨é€‰æ‰‹å¯åŠ¨å®¹å™¨æ—¶ï¼ŒåŠ¨æ€è®¾ç½®å®¹å™¨çš„çŽ¯å¢ƒå˜é‡ï¼›

è¿™ä¸¤ä¸ªä¾µå…¥ç‚¹éƒ½æ˜¯å¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•çš„ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªä¾µå…¥ç‚¹çš„é€»è¾‘éƒ½æ˜¯å¯ä»¥å®Œå…¨è‡ªå®šä¹‰çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®žçŽ°å„ç§å„æ ·çš„é¢˜ç›®ç±»åž‹äº†ã€‚

```rust
pub trait FlagChecker {
  async fn check(&self, user: &User, challenge: &Challenge, flag: &str) -> Result<bool, CheckerError>;
  async fn get(&self, user: &User, challenge: &Challenge) -> Result<String, CheckerError>;
  async fn env_vars(&self, user: &User, challenge: &Challenge) -> Result<HashMap<String, String>, CheckerError>;
}

...

pub struct StaticAttachmentChecker {
}

pub struct DynamicAttachmentChecker {
  cache: &RedisPool,
}

pub struct EnvironmentChecker {
  cache: &RedisPool,
}
```
